import os,sys

class PM100USB:
	def __init__(self,address=None,name='THORLABS PM100USB', mask='/dev/usbtmc*'):
		if address is None:
			from useful import SelectAddress
			address = SelectAddress(name,mask)
			self.address = address

	def ask(self,cmd):
		self.write(cmd)
		print self.read()

	def connect(self):
		try:
                	h = open(self.address, 'r+')
                except :
                        if e.errno == 13:
                                os.system("sudo chmod 777 " + address)
                                try:
                                        h = open(self.address, 'r+')
				except: 
					raise
			else:
				raise
		return h

	def write(self,cmd):
		h = self.connect()
		h.write(cmd)
		h.close()
	
	def read(self):
		h = self.connect()
		tmp =h.readline()
		h.close()
		return tmp
